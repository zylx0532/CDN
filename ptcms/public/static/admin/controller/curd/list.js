/** PTNovelSearch-v4.1.2 LPPL License By https://www.zhiqiang.name/ */
 ;"undefined"==typeof config&&(config={}),layui.define(config.module?config.module:["table","form"],function(e){var t=layui.$,a=layui.admin,i=(layui.view,layui.table),n=layui.form,o=[];config.search&&Object.keys(config.search).length>0&&(searchBox=t("#layui-search"),searchFieldBox=searchBox.show().find("#layui-search-fields"),t.each(config.search,function(e,a){a.type=a.type?a.type:"text",text=a.text?a.text:e,"undefined"!=typeof layui.router().search[e]&&(a.value=layui.router().search[e]);var i="";switch(a.type){case"url":case"text":case"date":case"phone":case"email":case"number":case"identity":("date"===a.type||a.date&&a.date===!0)&&o.push(e),a.placeholder=a.placeholder?a.placeholder:"请输入"+text,i='<input type="text" name="'+e+'" placeholder="'+a.placeholder+'" autocomplete="off" class="layui-input" value="'+(a.value?a.value:"")+'">';break;case"select":defaultValue=a.value?a.value:"",a.placeholder=a.placeholder?a.placeholder:"请选择"+text,i='<select lay-verify="'+a.type+'" name="'+e+'" class="layui-input" '+(a.search?"lay-search":"")+'><option value="">---'+a.placeholder+"---</option>",t.each(a.data,function(e,a){"object"==typeof a?(i+='<optgroup label="'+e+'">',t.each(a,function(e,t){i+='<option value="'+e+'"'+(defaultValue===e?" selected":"")+">"+t+"</option>"}),i+="</optgroup>"):i+='<option value="'+e+'"'+(defaultValue===e?" selected":"")+">"+a+"</option>"}),i+="</select>";break;case"range":begin=a.begin?a.begin:"begin",end=a.end?a.end:"end",a.date&&a.date===!0&&(o.push(e+"["+begin+"]"),o.push(e+"["+end+"]")),a.placeholder=a.placeholder?a.placeholder:"请输入"+text,i+='<div class="layui-input-inline" style="width: 100px;">',i+='<input type="text" name="'+e+"["+begin+']" placeholder="'+a.placeholder+'" autocomplete="off" class="layui-input">',i+='</div><div class="layui-form-mid">-</div>',i+='<div class="layui-input-inline" style="width: 100px;">',i+='<input type="text" name="'+e+"["+end+']" placeholder="'+a.placeholder+'" autocomplete="off" class="layui-input">',i+="</div>"}i&&(i='<div class="layui-inline"><label class="layui-form-label">'+text+'</label><div class="layui-input-block">'+i+"</div></div>",searchFieldBox.append(i))})),o.length>0&&layui.use("laydate",function(){var e={type:"datetime",format:"yyyy-MM-dd HH:mm:ss"};t.each(o,function(t,a){(offset=a.lastIndexOf("["))>-1?filed=config.search[a.slice(0,a.lastIndexOf("["))]:filed=config.search[a],layui.laydate.render(Object.assign({},e,filed.config&&"object"==typeof filed.config?filed.config:{},{elem:'input[name="'+a+'"]'}))})}),config.topButton&&t.each(config.topButton,function(e,a){var i,n,o;"add"===e?(i="",n="添加"):"del"===e?(i="layui-btn-danger",n="删除"):"enable"===e?(i="",n="启用"):"disable"===e?(i="layui-btn-warm",n="禁用"):"reorder"===e?(i="",n="排序"):n=e,i=a.style?a.style:i,n=a.text?a.text:n,o=a.url?'data-url="'+a.url+'"':"",t("#layui-top-button").append('<button class="layui-btn '+i+'" data-type="'+e+'" '+o+">"+n+"</button>")}),n.render(),config.actionButton&&t.each(config.actionButton,function(e,a){var i,n,o,c;"del"===e?(i="layui-icon layui-icon-delete",n="layui-btn-danger",o="删除"):"edit"===e?(i="layui-icon layui-icon-edit",n="layui-btn-normal",o="编辑"):o=e,i=a.icon?a.icon:i,n=a.style?a.style:n,o=a.text?a.text:o,c=a.url?'data-url="'+a.url+'"':"",t("#table-curd-list").append('<a class="layui-btn layui-btn-xs '+n+'" lay-event="'+e+'" '+c+'><i class="'+i+'"></i>'+o+"</a>")});var c=Object.assign({elem:"#LAY-curd-table",url:config.api.list,where:"undefined"==typeof config.table.where?{}:config.table.where,cols:config.table.cols,page:"undefined"!=typeof config.table.page&&config.table.page,limit:"undefined"==typeof config.table.limit?30:config.table.limit,height:"undefined"==typeof config.table.height?"full-320":config.table.height,done:"undefined"==typeof config.table.done?function(){}:config.table.done},config.table.config?config.table.config:{});"undefined"==typeof c.where.access_token&&(c.where.access_token=layui.data("layuiAdmin").access_token),config.search&&Object.keys(config.search).length>0&&Object.keys(layui.router().search).length>0&&(c.where=Object.assign(c.where,layui.router().search)),tableIns=i.render(c),n.on("submit(LAY-front-search)",function(e){var t=e.field;i.reload("LAY-curd-table",{where:t})}),t("#layui-search-fields input").on("keyup",function(e){13===e.keyCode&&t("#layui-search-button button").click()}),t("#layui-top-button button").on("click",function(){var e=t(this).data("type");if("function"==typeof config.topButton[e].action)return config.topButton[e].action.call(this);if("add"===e)location.hash=t(this).data("url")?t(this).data("url"):layui.router().href+"add";else{var n=[],o=[],c=i.checkStatus("LAY-curd-table").data;"del"===e?(confirmMessage="确定删除吗","string"==typeof config.topButton[e].confirmMessage&&(confirmMessage=config.topButton[e].confirmMessage),layer.confirm(confirmMessage,function(t){layui.each(c,function(e,t){n.push(t.id)}),a.req({url:config.api.batch,data:{type:"del",items:n},method:"POST",success:function(t){"function"==typeof config.topButton[e].success?config.topButton[e].success.call(this):(i.reload("LAY-curd-table"),layer.msg("已删除"))}})})):"reorder"===e?(layui.each(c,function(e,t){n.push(t.id),o.push(t.position)}),a.req({url:config.api.batch,data:{type:"change",items:n,field:"position",values:o},method:"POST",success:function(e){i.reload("LAY-curd-table"),layer.msg("已更新排序")}})):"undefined"!=typeof config.topButton[e].field&&"undefined"!=typeof config.topButton[e].value&&(layui.each(c,function(t,a){n.push(a.id),o.push(config.topButton[e].value)}),layui.admin.req({url:config.api.batch,data:{type:"change",items:n,field:config.topButton[e].field,values:o},method:"POST",success:function(e){layui.table.reload("LAY-curd-table"),layui.layer.msg("禁用成功")}}))}}),n.on("switch(table-switch)",function(e){"function"==typeof config.switchAction?config.switchAction.call(this,e):a.req({url:config.api.change,data:{id:this.value,field:t(this).data("field"),value:e.elem.checked?1:0},method:"POST",success:function(t){layer.tips("修改成功",e.othis)}})}),i.on("tool(LAY-curd-table)",function(e){var i=e.data;"function"==typeof config.actionButton[e.event].action?config.actionButton[e.event].action.call(this,e):"del"===e.event?(confirmMessage="真的删除这条记录么","string"==typeof config.actionButton[e.event].confirmMessage&&(confirmMessage=config.actionButton[e.event].confirmMessage),layer.confirm(confirmMessage,function(t){a.req({url:config.api.del,data:{id:i.id},method:"POST",success:function(t){"function"==typeof config.actionButton[e.event].success?config.actionButton[e.event].success.call(this,e):(layer.msg("删除成功"),e.del())}}),layer.close(t)})):"edit"===e.event&&(location.hash=(t(this).data("url")?t(this).data("url"):layui.router().href+"edit")+"/id="+i.id)}),i.on("edit(LAY-curd-table)",function(e){if("function"==typeof config.tableEdit)config.tableEdit(e,this);else{t(this).prev().text();e.data.id||(layer.msg("修改失败",function(){}),i.reload("LAY-curd-table")),a.req({url:config.api.change,data:{id:e.data.id,field:e.field,value:e.value},method:"POST",success:function(e){e.code?layer.msg(e.msg,function(){}):layer.msg("修改成功")}})}}),"function"==typeof config.done&&config.done(layui),e("curd/list",{})});